import{jsx as e,jsxs as r,Fragment as B}from"react/jsx-runtime";import*as H from"react";import{useState as k,useEffect as ne,useMemo as Y,useCallback as oe}from"react";import{useNavigate as be}from"@tanstack/react-router";import{useMutation as ye}from"@tanstack/react-query";import Se from"axios";import{AnimatePresence as te,motion as V}from"framer-motion";import{z as N}from"zod";import{clsx as we}from"clsx";import{twMerge as Ne}from"tailwind-merge";import*as ke from"recharts";import{ResponsiveContainer as ze,LineChart as Ce,CartesianGrid as Pe,XAxis as Ee,YAxis as Oe,ReferenceLine as _e,Tooltip as De,Line as le}from"recharts";import{Slot as Te}from"@radix-ui/react-slot";import{cva as je}from"class-variance-authority";import*as Fe from"@radix-ui/react-label";import*as ce from"@radix-ui/react-switch";import*as A from"@radix-ui/react-slider";import*as z from"@radix-ui/react-select";import{ChevronDownIcon as pe,CheckIcon as Re,ChevronUpIcon as We,Sun as Le,BatteryCharging as Be,Car as Ie,Info as R,ExternalLink as Ae,ArrowLeft as ge,Check as Ge,Compass as He,Loader2 as $e,Share2Icon as Me}from"lucide-react";import*as I from"@radix-ui/react-tooltip";import{useDebouncedCallback as Ye}from"use-debounce";import{R as Ve}from"./ssr-BdLlVWx6.mjs";import"@tanstack/zod-adapter";import"tiny-invariant";import"node:stream";import"isbot";import"react-dom/server";import"@tanstack/start-server-core";const de=(t,a="£")=>`${a}${t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`,Ue=Se.create({baseURL:"http://localhost:8080",headers:{"Content-Type":"application/json"}}),Je=async t=>{const{data:a}=await Ue.post("/api/roi/calculate",t);return a},qe=(t,a,n,i)=>ye({mutationFn:Je,onMutate:()=>{console.log("Mutation starting (onMutate)... calculation beginning."),t(!1)},onSuccess:o=>{console.log("Calculation successful:",o),a(o),t(!1),n||i(!0)},onError:o=>{console.error("Calculation failed:",o),a(null),t(!1),n||i(!0)},onSettled:()=>{console.log("Mutation settled."),t(!1)}});function p(...t){return Ne(we(t))}function U({className:t,...a}){return e("div",{"data-slot":"card",className:p("bg-card text-card-foreground flex flex-col 3 rounded-xl border py-6 shadow-sm",t),...a})}function J({className:t,...a}){return e("div",{"data-slot":"card-header",className:p("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function q({className:t,...a}){return e("div",{"data-slot":"card-title",className:p("leading-none font-semibold",t),...a})}function ie({className:t,...a}){return e("div",{"data-slot":"card-description",className:p("text-muted-foreground text-sm",t),...a})}function K({className:t,...a}){return e("div",{"data-slot":"card-content",className:p("px-6",t),...a})}function $({title:t,value:a,description:n}){return r(U,{className:"flex flex-col justify-center min-h-[120px]",children:[r(J,{className:"pb-2 text-center",children:[e(q,{className:"text-sm font-medium",children:t}),n&&e(ie,{children:n})]}),e(K,{className:"text-center",children:e("div",{className:"text-2xl font-bold",children:a})})]})}const Ke={light:"",dark:".dark"},ve=H.createContext(null);function Xe(){const t=H.useContext(ve);if(!t)throw new Error("useChart must be used within a <ChartContainer />");return t}function Ze({id:t,className:a,children:n,config:i,...o}){const v=H.useId(),c=`chart-${t||v.replace(/:/g,"")}`;return e(ve.Provider,{value:{config:i},children:r("div",{"data-slot":"chart","data-chart":c,className:p("[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",a),...o,children:[e(Qe,{id:c,config:i}),e(ke.ResponsiveContainer,{children:n})]})})}const Qe=({id:t,config:a})=>{const n=Object.entries(a).filter(([,i])=>i.theme||i.color);return n.length?e("style",{dangerouslySetInnerHTML:{__html:Object.entries(Ke).map(([i,o])=>`
${o} [data-chart=${t}] {
${n.map(([v,c])=>{const d=c.theme?.[i]||c.color;return d?`  --color-${v}: ${d};`:null}).join(`
`)}
}
`).join(`
`)}}):null};function et({active:t,payload:a,className:n,indicator:i="dot",hideLabel:o=!1,hideIndicator:v=!1,label:c,labelFormatter:d,labelClassName:y,formatter:l,color:g,nameKey:C,labelKey:S}){const{config:b}=Xe(),w=H.useMemo(()=>{if(o||!a?.length)return null;const[f]=a,D=`${S||f?.dataKey||f?.name||"value"}`,T=ue(b,f,D),P=!S&&typeof c=="string"?b[c]?.label||c:T?.label;return d?e("div",{className:p("font-medium",y),children:d(P,a)}):P?e("div",{className:p("font-medium",y),children:P}):null},[c,d,a,o,y,b,S]);if(!t||!a?.length)return null;const h=a.length===1&&i!=="dot";return r("div",{className:p("border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",n),children:[h?null:w,e("div",{className:"grid gap-1.5",children:a.map((f,D)=>{const T=`${C||f.name||f.dataKey||"value"}`,P=ue(b,f,T),j=g||f.payload.fill||f.color;return e("div",{className:p("[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5",i==="dot"&&"items-center"),children:l&&f?.value!==void 0&&f.name?l(f.value,f.name,f,D,f.payload):r(B,{children:[P?.icon?e(P.icon,{}):!v&&e("div",{className:p("shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)",{"h-2.5 w-2.5":i==="dot","w-1":i==="line","w-0 border-[1.5px] border-dashed bg-transparent":i==="dashed","my-0.5":h&&i==="dashed"}),style:{"--color-bg":j,"--color-border":j}}),r("div",{className:p("flex flex-1 justify-between leading-none",h?"items-end":"items-center"),children:[r("div",{className:"grid gap-1.5",children:[h?w:null,e("span",{className:"text-muted-foreground",children:P?.label||f.name})]}),f.value&&e("span",{className:"text-foreground font-mono font-medium tabular-nums",children:f.value.toLocaleString()})]})]})},f.dataKey)})})]})}function ue(t,a,n){if(typeof a!="object"||a===null)return;const i="payload"in a&&typeof a.payload=="object"&&a.payload!==null?a.payload:void 0;let o=n;return n in a&&typeof a[n]=="string"?o=a[n]:i&&n in i&&typeof i[n]=="string"&&(o=i[n]),o in t?t[o]:t[n]}const ae="#22c55e",re="#ef4444",tt={positiveSavings:{label:"Positive Savings",color:ae},negativeSavings:{label:"Negative Balance",color:re}};function at({chartData:t}){const a=i=>`£${i.toLocaleString()}`,n=t.dataPoints.map(i=>({...i,positiveSavings:i.cumulativeSavings>=0?i.cumulativeSavings:null,negativeSavings:i.cumulativeSavings<0?i.cumulativeSavings:null}));return e(Ze,{config:tt,className:"min-h-[250px] w-full aspect-video",children:e(ze,{width:"100%",height:"100%",children:r(Ce,{accessibilityLayer:!0,data:n,margin:{top:10,right:10,left:10,bottom:0},children:[e(Pe,{vertical:!1,strokeDasharray:"3 3"}),e(Ee,{dataKey:"year",tickLine:!1,axisLine:!1,tickMargin:8,fontSize:14,name:"Year"}),e(Oe,{tickFormatter:a,tickLine:!1,axisLine:!1,tickMargin:4,fontSize:12,width:80,name:"Savings",domain:["auto","auto"]}),e(_e,{y:0,stroke:"orange",strokeDasharray:"2 2",label:{value:"Break Even",position:"insideTopRight",dy:-25,fill:"orange",fontSize:14}}),e(De,{cursor:{strokeDasharray:"3 3"},content:e(et,{formatter:a,indicator:"dot"})}),e(le,{dataKey:"negativeSavings",type:"monotone",stroke:re,strokeWidth:2,dot:{r:4,fill:re},activeDot:{r:6},connectNulls:!1}),e(le,{dataKey:"positiveSavings",type:"monotone",stroke:ae,strokeWidth:2,dot:{r:4,fill:ae},activeDot:{r:6},connectNulls:!1})]})})})}const rt=je("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function x({className:t,variant:a,size:n,asChild:i=!1,...o}){return e(i?Te:"button",{"data-slot":"button",className:p(rt({variant:a,size:n,className:t})),...o})}function W({className:t,...a}){return e(Fe.Root,{"data-slot":"label",className:p("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}function nt({className:t,...a}){return e(ce.Root,{"data-slot":"switch",className:p("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:e(ce.Thumb,{"data-slot":"switch-thumb",className:p("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const G=H.forwardRef(({className:t,...a},n)=>r(A.Root,{ref:n,className:p("relative flex w-full touch-none select-none items-center",t),...a,children:[e(A.Track,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e(A.Range,{className:"absolute h-full bg-primary"})}),e(A.Thumb,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));G.displayName=A.Root.displayName;function it({...t}){return e(z.Root,{"data-slot":"select",...t})}function st({...t}){return e(z.Value,{"data-slot":"select-value",...t})}function ot({className:t,size:a="default",children:n,...i}){return r(z.Trigger,{"data-slot":"select-trigger","data-size":a,className:p("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...i,children:[n,e(z.Icon,{asChild:!0,children:e(pe,{className:"size-4 opacity-50"})})]})}function lt({className:t,children:a,position:n="popper",...i}){return e(z.Portal,{children:r(z.Content,{"data-slot":"select-content",className:p("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...i,children:[e(dt,{}),e(z.Viewport,{className:p("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),e(ut,{})]})})}function ct({className:t,children:a,...n}){return r(z.Item,{"data-slot":"select-item",className:p("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...n,children:[e("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e(z.ItemIndicator,{children:e(Re,{className:"size-4"})})}),e(z.ItemText,{children:a})]})}function dt({className:t,...a}){return e(z.ScrollUpButton,{"data-slot":"select-scroll-up-button",className:p("flex cursor-default items-center justify-center py-1",t),...a,children:e(We,{className:"size-4"})})}function ut({className:t,...a}){return e(z.ScrollDownButton,{"data-slot":"select-scroll-down-button",className:p("flex cursor-default items-center justify-center py-1",t),...a,children:e(pe,{className:"size-4"})})}function xe({delayDuration:t=0,...a}){return e(I.Provider,{"data-slot":"tooltip-provider",delayDuration:t,...a})}function E({...t}){return e(xe,{children:e(I.Root,{"data-slot":"tooltip",...t})})}function O({...t}){return e(I.Trigger,{"data-slot":"tooltip-trigger",...t})}function _({className:t,sideOffset:a=0,children:n,...i}){return e(I.Portal,{children:r(I.Content,{"data-slot":"tooltip-content",sideOffset:a,className:p("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...i,children:[n,e(I.Arrow,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}const mt=["north","north-east","north-west","south","south-east","south-west","east","west"],me=.4,M=1.5,ht=20,ft=1500,pt=2e4,gt=0,vt=20;function xt({formData:t,onFormDataChange:a}){const[n,i]=k(t),[o,v]=k(t.solarSize>0),[c,d]=k(t.batterySize>0),[y,l]=k(t.solarSize>0?t.solarSize:M),[g,C]=k(t.batterySize>0?t.batterySize:1);ne(()=>{i(t);const s=t.solarSize>0,m=t.batterySize>0;v(s),d(m),s&&l(t.solarSize),m&&C(t.batterySize)},[t]),Y(()=>c?1:0,[c]);const S=.1,b=1,w=500,h=(s,m)=>{const u=m[0],F={...n,[s]:u};i(F),a(F),s==="solarSize"&&o&&l(u),s==="batterySize"&&c&&C(u)},f=(s,m)=>{const u={...n,[s]:m};i(u),a(u)},D=(s,m)=>{const u={...n,[s]:m};i(u),a(u)},T=s=>{v(s);const u={...n,solarSize:s?y:0};i(u),a(u),s&&y<M&&l(M)},P=s=>{d(s);const m=1,u=g>=m?g:m,se={...n,batterySize:s?u:0};i(se),a(se),s&&g<m&&C(m)},j=Y(()=>!o||n.solarSize<me?0:Math.round(n.solarSize/me),[n.solarSize,o]);return r(U,{children:[e(J,{children:e(q,{className:"text-center",children:"Calculator Inputs"})}),e(K,{children:e(xe,{children:r("div",{className:"space-y-6",children:[e("div",{className:"text-sm font-semibold text-center text-muted-foreground pt-2",children:"Toggle On/Off Core Features"}),r("div",{className:"flex flex-row space-x-2 justify-between items-center pb-4 border-b sm:flex-row sm:space-x-4 sm:justify-around sm:space-y-0",children:[r(E,{children:[e(O,{asChild:!0,children:r(x,{variant:o?"default":"outline",onClick:()=>T(!o),className:`cursor-pointer transition-colors flex-grow sm:flex-grow-0 sm:w-24 h-14 md:h-16 flex flex-col items-center justify-center space-y-1 ${o?"bg-green-500 hover:bg-green-600 text-white":"text-muted-foreground"}`,children:[e(Le,{className:"h-6 w-6"}),e("span",{className:"text-xs font-medium",children:"Solar"})]})}),e(_,{children:r("p",{children:["Toggle Solar System ",o?"Off":"On"]})})]}),r(E,{children:[e(O,{asChild:!0,children:r(x,{variant:c?"default":"outline",onClick:()=>P(!c),className:`cursor-pointer transition-colors flex-grow sm:flex-grow-0 sm:w-24 h-14 md:h-16 flex flex-col items-center justify-center space-y-1 ${c?"bg-blue-500 hover:bg-blue-600 text-white":"text-muted-foreground"}`,children:[e(Be,{className:"h-6 w-6"}),e("span",{className:"text-xs font-medium",children:"Battery"})]})}),e(_,{children:r("p",{children:["Toggle Battery Storage ",c?"Off":"On"]})})]}),r(E,{children:[e(O,{asChild:!0,children:r(x,{variant:n.haveOrWillGetEv?"default":"outline",onClick:()=>D("haveOrWillGetEv",!n.haveOrWillGetEv),className:`cursor-pointer transition-colors flex-grow sm:flex-grow-0 sm:w-24 h-14 md:h-16 flex flex-col items-center justify-center space-y-1 ${n.haveOrWillGetEv?"bg-purple-500 hover:bg-purple-600 text-white":"text-muted-foreground"}`,children:[e(Ie,{className:"h-6 w-6"}),e("span",{className:"text-xs font-medium",children:"EV"})]})}),r(_,{children:[r("p",{children:[n.haveOrWillGetEv?"Disable":"Enable"," EV Presence"]}),e("p",{className:"text-xs max-w-xs text-center pt-1",children:"Indicate if you have or plan to get an Electric Vehicle."})]})]})]}),e(te,{children:o&&e(V.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"overflow-hidden",children:r("div",{className:"space-y-2 pt-4 mb-2",children:[r("div",{className:"flex items-center justify-between",children:[r("div",{className:"flex items-center space-x-1",children:[e(W,{htmlFor:"solar",children:"Solar System Size (kWp)"}),j>0&&r("span",{className:"text-xs text-muted-foreground ml-1",children:["(~",j," panels)"]}),r(E,{children:[e(O,{asChild:!0,children:e(x,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0",type:"button",children:e(R,{className:"h-4 w-4"})})}),e(_,{className:"max-w-xs",children:e("p",{className:"text-center",children:"The peak power output of your solar panel array in kilowatts (kWp). This determines how much energy can be generated."})})]})]}),r("span",{className:"text-sm font-medium text-muted-foreground",children:[n.solarSize.toFixed(1)," kWp"]})]}),e(G,{id:"solar",min:M,max:ht,step:S,value:[n.solarSize],onValueChange:s=>h("solarSize",s),disabled:!o,className:"mt-2"})]})},"solar-details")}),e(te,{children:c&&e(V.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"overflow-hidden",children:r("div",{className:"space-y-2 pt-4 mb-2",children:[r("div",{className:"flex items-center justify-between",children:[r("div",{className:"flex items-center space-x-1",children:[e(W,{htmlFor:"battery",children:"Battery Size (kWh)"}),r(E,{children:[e(O,{asChild:!0,children:e(x,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0",type:"button",children:e(R,{className:"h-4 w-4"})})}),e(_,{className:"max-w-xs",children:e("p",{className:"text-center",children:"The storage capacity of your battery system in kilowatt-hours. Larger batteries store more excess solar energy for later use."})})]})]}),r("span",{className:"text-sm font-medium text-muted-foreground",children:[n.batterySize.toFixed(1)," kWh"]})]}),e(G,{id:"battery",min:gt,max:vt,step:b,value:[n.batterySize],onValueChange:s=>h("batterySize",s),disabled:!c,className:"mt-2"})]})},"battery-details")}),r("div",{className:"space-y-2",children:[r("div",{className:"flex items-center space-x-1",children:[e(W,{htmlFor:"direction",children:"Solar Panel Direction"}),r(E,{children:[e(O,{asChild:!0,children:e(x,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0",type:"button",children:e(R,{className:"h-4 w-4"})})}),e(_,{className:"max-w-xs",children:e("p",{className:"text-center",children:"Facing south generally yields the most energy, but other directions can be viable depending on roof shape and local conditions."})})]})]}),r(it,{value:n.solarPanelDirection,onValueChange:s=>f("solarPanelDirection",s),children:[e(ot,{id:"direction",children:e(st,{placeholder:"Select direction"})}),e(lt,{children:mt.map(s=>e(ct,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1).replace("-"," ")},s))})]})]}),r("div",{className:"space-y-2",children:[r("div",{className:"flex items-center justify-between",children:[r("div",{className:"flex items-center space-x-1",children:[e(W,{htmlFor:"usage",children:"Annual Usage (kWh)"}),r(E,{children:[e(O,{asChild:!0,children:e(x,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0",type:"button",children:e(R,{className:"h-4 w-4"})})}),e(_,{className:"max-w-xs",children:e("p",{className:"text-center",children:"Your estimated total household electricity consumption per year in kilowatt-hours. Check your utility bills for accuracy."})})]})]}),r("span",{className:"text-sm font-medium text-muted-foreground",children:[n.usage.toLocaleString()," kWh"]})]}),e(G,{id:"usage",min:ft,max:pt,step:w,value:[n.usage],onValueChange:s=>h("usage",s),className:"mt-2"})]}),r("div",{className:"space-y-3 pt-4 border-t",children:[r("div",{className:"space-y-2",children:[r("div",{className:"flex items-center justify-between",children:[r("div",{className:"flex items-center space-x-1",children:[e(W,{htmlFor:"occupancy",children:"Home Occupancy Level"}),r(E,{children:[e(O,{asChild:!0,children:e(x,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0",type:"button",children:e(R,{className:"h-4 w-4"})})}),e(_,{className:"max-w-xs",children:e("p",{className:"text-center",children:"How often someone is home during work hours (9am-5pm). Higher levels mean more daytime energy usage and direct consumption of solar power."})})]})]}),r("span",{className:"text-sm font-medium text-muted-foreground",children:["Level ",n.homeOccupancyDuringWorkHours]})]}),e(G,{id:"occupancy",min:1,max:5,step:1,value:[n.homeOccupancyDuringWorkHours],onValueChange:s=>h("homeOccupancyDuringWorkHours",s),className:"mt-2"}),r("div",{className:"flex justify-between text-xs text-muted-foreground px-1",children:[e("span",{children:"Never home"}),e("span",{children:"Always home"})]})]}),r("div",{className:"flex items-center justify-between space-x-2",children:[r("div",{className:"flex items-center space-x-1",children:[e(W,{htmlFor:"finance",children:"Need Finance?"}),r(E,{children:[e(O,{asChild:!0,children:e(x,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0",type:"button",children:e(R,{className:"h-4 w-4"})})}),e(_,{className:"max-w-xs",children:e("p",{className:"text-center",children:"Select if you plan to finance the system purchase. This affects the initial cost assumption (currently assumes cash purchase)."})})]})]}),e(nt,{id:"finance",checked:n.needFinance,onCheckedChange:s=>D("needFinance",s)})]})]})]})})})]})}const he=[{name:"James' Link",url:"https://share.octopus.energy/sky-hare-157",description:"Switch to Octopus Energy using this link and you'll both get £50 credit!"},{name:"Dad's Link",url:"https://share.octopus.energy/happy-run-144",description:"Switch to Octopus Energy via this link and we both get £50 credit!"}];function fe(){const[t,a]=k(he[0]);return ne(()=>{const n=Math.random()<.5?0:1;a(he[n])},[]),r(U,{className:"bg-gradient-to-r from-purple-100 via-pink-100 to-red-100 border-purple-200 overflow-hidden",children:[r(J,{className:"text-center pt-6 pb-3",children:[e(q,{className:"text-xl font-bold text-purple-800",children:"Switch & Save £50!"}),e(ie,{className:"text-purple-700 text-sm px-4",children:"Considering solar? Pair it with Octopus Energy's smart tariffs for maximum savings."})]}),r(K,{className:"text-center space-y-4 pb-6 px-6",children:[e("p",{className:"text-sm text-purple-600 italic",children:t.description}),e(x,{asChild:!0,variant:"default",className:"bg-purple-600 hover:bg-purple-700 text-white shadow-md hover:shadow-lg transition-shadow duration-200",children:r("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",children:["Switch to Octopus Energy",e(Ae,{className:"ml-2 h-4 w-4"})]})})]})]})}const L=[{id:"houseSize",title:"Your Home Size",question:"Roughly, how big is your home?",options:[{value:"small",label:"2 Bedrooms",image:"/small-house.svg",solarSize:2,panelRangeText:"Up to 4 Panels"},{value:"medium",label:"3 Bedrooms",image:"/medium-house.svg",solarSize:3.2,panelRangeText:"5-8 Panels"},{value:"large",label:"4+ Bedrooms",image:"/large-house.svg",solarSize:4.8,panelRangeText:"9+ Panels"}]},{id:"roofDirection",title:"Solar Panel Direction",question:"Which direction will the solar panels primarily face on your roof?",options:[{value:"north",label:"North"},{value:"north-east",label:"North-East"},{value:"north-west",label:"North-West"},{value:"south",label:"South"},{value:"south-east",label:"South-East"},{value:"south-west",label:"South-West"},{value:"east",label:"East"},{value:"west",label:"West"},{value:"dont_know",label:"Don't Know"}]},{id:"hasEv",title:"Electric Vehicle",question:"Do you own or plan to get an Electric Vehicle (EV)?",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{id:"isHome",title:"Home Occupancy",question:"Is someone usually home during weekday work hours (9am-5pm)?",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{id:"needsFinance",title:"Payment Method",question:"How do you plan to pay for the system?",options:[{value:"no",label:"Cash / Own Funds"},{value:"yes",label:"Finance / Loan"}]}],bt=({options:t,selectedValue:a,onSelect:n})=>{const i=t.filter(c=>c.value!=="dont_know"),o=t.find(c=>c.value==="dont_know"),v={north:{top:"0%",left:"50%",transform:"translateX(-50%)"},"north-east":{top:"15%",left:"85%",transform:"translate(-50%, -50%)"},east:{top:"50%",left:"95%",transform:"translateY(-50%) translateX(-50%)"},"south-east":{top:"85%",left:"85%",transform:"translate(-50%, -50%)"},south:{top:"100%",left:"50%",transform:"translate(-50%, -100%)"},"south-west":{top:"85%",left:"15%",transform:"translate(-50%, -50%)"},west:{top:"50%",left:"5%",transform:"translateY(-50%) translateX(-50%)"},"north-west":{top:"15%",left:"15%",transform:"translate(-50%, -50%)"}};return r("div",{className:"flex flex-col items-center space-y-6",children:[r("div",{className:"relative w-56 h-56 sm:w-64 sm:h-64 flex items-center justify-center",children:[e("div",{className:"absolute inset-1 sm:inset-2 border border-border rounded-full pointer-events-none"}),e("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-muted-foreground",children:e(He,{className:"h-10 w-10 sm:h-12 sm:w-12"})}),i.map(c=>{const d=v[c.value],y=a===c.value;return d?e(x,{variant:y?"default":"outline",size:"sm",className:`absolute transition-all duration-150 ease-in-out text-xs sm:text-sm w-20 sm:w-24 ${y?"ring-2 ring-primary ring-offset-2 ring-offset-background scale-110 shadow-lg z-10":"hover:scale-105"}`,style:{top:d.top,left:d.left,transform:d.transform},onClick:()=>n(c.value),children:c.label},c.value):null})]}),o&&e(x,{variant:a==="dont_know"?"default":"outline",className:`w-48 mt-6 ${a==="dont_know"?"ring-2 ring-primary ring-offset-2 ring-offset-background scale-105 shadow-lg":""}`,onClick:()=>n("dont_know"),children:o.label})]})};function yt({onComplete:t}){const[a,n]=k(0),[i,o]=k({}),v=(l,g,C)=>{const S={...i,[l]:g};if(l==="houseSize"&&C!==void 0)S.estimatedSolarSize=C;else if(l==="houseSize"){const b=L.find(w=>w.id==="houseSize")?.options.find(w=>w.value===g);b&&"solarSize"in b&&b.solarSize!==void 0&&(S.estimatedSolarSize=b.solarSize)}o(S),a<L.length-1?n(a+1):(console.log("Guide complete, calling onComplete with:",S),t(S))},c=()=>{a>0&&n(a-1)},d=L[a],y=(a+1)/L.length*100;return r(U,{className:"border-primary/50 overflow-hidden bg-gradient-to-br from-background to-muted/20 p-2 sm:p-4",children:[r(J,{className:"pb-4",children:[e(q,{className:"text-xl text-primary",children:"Quick Estimate Guide"}),e(ie,{children:"Answer a few simple questions to get a starting estimate."}),r("div",{className:"flex justify-between items-center pt-3",children:[a>0?e(x,{variant:"ghost",size:"icon",onClick:c,"aria-label":"Go back",children:e(ge,{className:"h-5 w-5"})}):e("div",{className:"w-8 h-8"}),r("div",{className:"text-sm font-medium text-muted-foreground",children:["Step ",a+1," of ",L.length," (",y.toFixed(0),"%)"]}),e("div",{className:"w-8 h-8"})]})]}),e(te,{mode:"wait",children:e(V.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},children:r(K,{className:"space-y-6 p-4 sm:p-6 pt-2",children:[r("div",{children:[e("p",{className:"font-medium text-lg mb-6",children:`${a+1}. ${d.question}`}),d.id==="roofDirection"?e(bt,{options:d.options,selectedValue:i[d.id],onSelect:l=>v(d.id,l)}):e("div",{className:`grid grid-cols-1 gap-4 ${d.id==="houseSize"?"sm:grid-cols-2 lg:grid-cols-3":"sm:grid-cols-3"}`,children:d.options.map(l=>{const g=i[d.id]===l.value;return r(x,{variant:g?"default":"outline",className:`flex flex-col items-center justify-center text-center h-auto p-4 transition-all duration-150 ease-in-out relative overflow-hidden
                        ${g?"bg-accent text-accent-foreground ring-2 ring-primary ring-offset-2 ring-offset-background scale-105 shadow-lg hover:bg-accent hover:text-accent-foreground":"hover:bg-accent"}`,onClick:()=>v(d.id,l.value,d.id==="houseSize"&&"solarSize"in l?l.solarSize:void 0),children:[i[d.id]===l.value&&e("div",{className:"absolute top-2 right-2 bg-primary rounded-full p-1 z-10",children:e(Ge,{className:"h-4 w-4 text-primary-foreground"})}),d.id==="houseSize"&&"image"in l?r(B,{children:[e("div",{className:"mb-3 w-20 h-20 relative flex justify-center items-center",children:e("img",{src:l.image,alt:`${l.label} house illustration`,className:"max-w-full max-h-full object-contain"})}),e("span",{className:"font-medium mb-1 text-center",children:l.label}),"panelRangeText"in l&&l.panelRangeText&&e("span",{className:"text-xs text-muted-foreground mt-0.5 text-center",children:l.panelRangeText}),"solarSize"in l&&l.solarSize!==void 0&&r("span",{className:"text-xs text-muted-foreground mt-0.5 text-center",children:["Est. ",l.solarSize," kWp Solar"]})]}):e("span",{className:"flex-1 font-medium flex items-center justify-center",children:l.label})]},l.value)})})]}),e("div",{className:"flex justify-center items-center space-x-3 pt-4",children:L.map((l,g)=>e("div",{className:`h-2.5 w-2.5 rounded-full transition-colors duration-300 ${g<=a?"bg-primary":"bg-muted"}`},g))})]})},a)})]})}const X=N.object({houseSize:N.enum(["small","medium","large"]).optional(),roofDirection:N.enum(["north","north-east","north-west","south","south-east","south-west","east","west","dont_know"]).optional(),hasEv:N.enum(["yes","no"]).optional(),isHome:N.enum(["yes","no"]).optional(),needsFinance:N.enum(["yes","no"]).optional(),batterySize:N.coerce.number().min(0).max(20).optional(),solarSize:N.coerce.number().min(1.5).max(20).optional(),usage:N.coerce.number().min(1500).max(2e4).optional(),solarPanelDirection:N.enum(["north","north_east","north_west","south","south_east","south_west","east","west"]).optional(),haveOrWillGetEv:N.coerce.boolean().optional(),homeOccupancyDuringWorkHours:N.coerce.number().min(1).max(5).optional(),needFinance:N.coerce.boolean().optional()}),Z={solarPanelDirection:"south",haveOrWillGetEv:!1,homeOccupancyDuringWorkHours:3,needFinance:!1,batterySize:10,usage:4500,solarSize:5},St=t=>{const a={};return t.houseSize&&(a.usage=t.houseSize==="small"?3e3:t.houseSize==="medium"?4500:6e3,a.solarSize=t.houseSize==="small"?1.5:t.houseSize==="medium"?3.2:4.8),t.roofDirection&&t.roofDirection!=="dont_know"?a.solarPanelDirection=t.roofDirection:t.roofDirection==="dont_know"&&(a.solarPanelDirection="south"),t.hasEv!==void 0&&(a.haveOrWillGetEv=t.hasEv==="yes"),t.isHome!==void 0&&(a.homeOccupancyDuringWorkHours=t.isHome==="yes"?4:2),t.needsFinance!==void 0&&(a.needFinance=t.needsFinance==="yes"),a},wt=t=>{const a={};return t.batterySize!==void 0&&(a.batterySize=t.batterySize),t.solarSize!==void 0&&(a.solarSize=t.solarSize),t.usage!==void 0&&(a.usage=t.usage),t.solarPanelDirection!==void 0&&(a.solarPanelDirection=t.solarPanelDirection.replace("_","-")),t.haveOrWillGetEv!==void 0&&(a.haveOrWillGetEv=t.haveOrWillGetEv),t.homeOccupancyDuringWorkHours!==void 0&&(a.homeOccupancyDuringWorkHours=t.homeOccupancyDuringWorkHours),t.needFinance!==void 0&&(a.needFinance=t.needFinance),a},Q=t=>{const a=Object.keys(t).some(o=>["batterySize","solarSize","usage","solarPanelDirection","haveOrWillGetEv","homeOccupancyDuringWorkHours","needFinance"].includes(o)&&t[o]!==void 0),n=Object.keys(t).some(o=>["houseSize","roofDirection","hasEv","isHome","needsFinance"].includes(o)&&t[o]!==void 0);let i;return a?i={...Z,...wt(t)}:n?i={...Z,...St(t)}:i={...Z},i},ee=t=>{const a={batterySize:t.batterySize,solarSize:t.solarSize,usage:t.usage,solarPanelDirection:t.solarPanelDirection.replace("-","_"),haveOrWillGetEv:t.haveOrWillGetEv,homeOccupancyDuringWorkHours:t.homeOccupancyDuringWorkHours,needFinance:t.needFinance};return Object.entries(a).filter(([n,i])=>i!==void 0).reduce((n,[i,o])=>({...n,[i]:o}),{})},Mt=function(){const[a,n]=k(null),i=Ve.useSearch(),o=be(),v=Y(()=>Q(i),[i]),c=Y(()=>Object.keys(i).some(m=>X.shape.hasOwnProperty(m)&&i[m]!==void 0),[i]),[d,y]=k(c),[l,g]=k(v),[C,S]=k("idle"),[b,w]=k(!1),h=qe(w,n,d,y),f=Ye(s=>{w(!1);const m=ee(s),F=ee(Q(i));JSON.stringify(m)!==JSON.stringify(F)&&o({search:m,replace:!0})},750);ne(()=>{const s=Q(i);JSON.stringify(l)!==JSON.stringify(s)&&(g(s),b&&(f.cancel(),w(!1)));const m=Object.keys(i).some(u=>X.shape.hasOwnProperty(u)&&i[u]!==void 0);if(d!==m&&y(m),m){const u=!h.variables||JSON.stringify(h.variables)!==JSON.stringify(s);!h.isPending&&!h.isSuccess||h.isSuccess&&u||h.isError&&u?(n(null),h.mutate(s)):h.isPending&&!u||h.isSuccess&&!u&&(a||n(h.data))}else a&&n(null)},[i,o]);const D=oe(s=>{s!==l&&JSON.stringify(s)!==JSON.stringify(l)&&(g(s),b||w(!0),f(s))},[l,f,b,w]),T=oe(s=>{const m={};for(const u in s)X.shape.hasOwnProperty(u)&&u!=="estimatedSolarSize"&&(m[u]=s[u]);o({to:"/",search:m,replace:!0})},[o]),P=async()=>{const s=new URL(window.location.href),m=new URLSearchParams(ee(l));s.search=m.toString();try{await navigator.clipboard.writeText(s.toString()),S("copied"),console.log("Share URL copied:",s.toString()),setTimeout(()=>S("idle"),2e3)}catch(u){console.error("Failed to copy share URL:",u)}};return r("div",{className:"container mx-auto p-4 md:p-8",children:[d?r(B,{children:[r(x,{variant:"ghost",size:"sm",onClick:()=>{o({to:"/",search:{},replace:!0})},className:"mb-4 -ml-2 flex items-center space-x-2 text-muted-foreground hover:text-foreground",children:[e(ge,{className:"h-4 w-4"}),e("span",{children:"Start Over"})]}),r("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[r("div",{className:"lg:col-span-2 space-y-8 order-2 lg:order-1",children:[h.isPending&&r("div",{className:"text-center text-muted-foreground py-10 min-h-[100px] flex items-center justify-center",children:[e($e,{className:"h-6 w-6 animate-spin inline mr-2"}),"Calculating..."]}),!h.isPending&&!a&&!h.isError&&e("div",{className:"text-center text-muted-foreground py-10 min-h-[100px] flex items-center justify-center",children:"Adjust the inputs on the right to calculate your potential savings."}),!h.isPending&&h.isError&&r("div",{className:"text-center text-red-600 py-10 min-h-[100px] flex flex-col items-center justify-center",children:[e("span",{children:"Calculation failed."}),e("span",{className:"text-sm text-red-500 mt-1",children:h.error?.message||"Please check inputs or try again."})]}),!h.isPending&&a&&r(B,{children:[e(B,{children:r("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e($,{title:"Total System Cost",value:de(a.totalCost.amount)}),e($,{title:"Yearly Savings",value:de(a.yearlySavings.amount)}),e($,{title:"Payback Period",value:`${a.paybackPeriod.years<0?">15":a.paybackPeriod.years} Years`}),e($,{title:`ROI (${a.roiPercentage.periodYears} Years)`,value:`${a.roiPercentage.percentage.toFixed(1)}%`})]})}),e(B,{children:r("div",{className:"bg-card p-4 md:p-6 rounded-lg shadow-sm relative",children:[e("h2",{className:"text-xl font-semibold mb-4 text-center",children:"Cumulative Savings Over Time"}),r("div",{className:"mt-2 md:mt-0 relative",children:[e(at,{chartData:a.roiChartData}),a.roiChartData.breakEvenYear!==null&&a.roiChartData.breakEvenYear>0&&r("p",{className:"text-sm text-muted-foreground mt-4 text-center",children:["Estimated break-even point around year"," ",a.roiChartData.breakEvenYear,"."]}),a.roiChartData.breakEvenYear!==null&&a.roiChartData.breakEvenYear<0&&r("p",{className:"text-sm text-muted-foreground mt-4 text-center",children:["Payback period may be longer than the system lifespan (",a.roiPercentage.periodYears," ","years)."]})]})]})})]})]}),r("div",{className:"lg:col-span-1 space-y-6 order-1 lg:order-2",children:[e(xt,{formData:l,onFormDataChange:D}),r(x,{onClick:P,disabled:C==="copied"||!a,className:"w-full",variant:"outline",children:[e(Me,{className:"mr-2 h-4 w-4"}),C==="copied"?"Link Copied!":"Share Calculation"]}),e("div",{className:"hidden md:block",children:e(fe,{})})]})]})]}):e(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5},className:"max-w-2xl mx-auto",children:e(yt,{onComplete:T})},"guide"),e("div",{className:"md:hidden mt-8",children:e(fe,{})}),d&&a&&!h.isPending&&e("footer",{className:"mt-12 pt-6 border-t border-border/40",children:e("p",{className:"text-center text-sm text-muted-foreground",children:"Disclaimer: This calculator provides approximate estimations based on standard assumptions and the inputs provided. Results should be used as a guide only and supplemented with professional assessments."})})]})};export{Mt as component};
